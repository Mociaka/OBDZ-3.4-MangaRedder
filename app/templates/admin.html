{% extends 'base.html' %}

{% block title %}–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å - Manga Reader{% endblock %}

{% block content %}
<div class="admin-container">
    <h1 class="admin-title">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è</h1>

    <div class="admin-grid">
        <!-- Add Manga Form -->
        <div class="admin-card">
            <h2 class="card-title">‚ûï –î–æ–¥–∞—Ç–∏ –º–∞–Ω–≥—É</h2>
            <form method="POST" action="{{ url_for('add_manga') }}" class="admin-form">
                <div class="form-group">
                    <label for="title">–ù–∞–∑–≤–∞ *</label>
                    <input type="text" id="title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="author">–ê–≤—Ç–æ—Ä</label>
                    <input type="text" id="author" name="author">
                </div>

                <div class="form-group">
                    <label for="cover_url">URL –æ–±–∫–ª–∞–¥–∏–Ω–∫–∏</label>
                    <input type="url" id="cover_url" name="cover_url" placeholder="https://example.com/cover.jpg">
                </div>

                <div class="form-group">
                    <label for="description">–û–ø–∏—Å</label>
                    <textarea id="description" name="description" rows="4"></textarea>
                </div>

                <button type="submit" class="btn-primary">–î–æ–¥–∞—Ç–∏ –º–∞–Ω–≥—É</button>
            </form>
        </div>

        <!-- Add Chapter Form -->
        <div class="admin-card">
            <h2 class="card-title">üìñ –î–æ–¥–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª</h2>
            <form method="POST" action="{{ url_for('add_chapter') }}" class="admin-form">
                <div class="form-group">
                    <label for="manga_id">–ú–∞–Ω–≥–∞ *</label>
                    <select id="manga_id" name="manga_id" required>
                        <option value="">–û–±–µ—Ä—ñ—Ç—å –º–∞–Ω–≥—É</option>
                        {% for manga in manga_list %}
                        <option value="{{ manga.id }}">{{ manga.title }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="chapter_number">–ù–æ–º–µ—Ä —Ä–æ–∑–¥—ñ–ª—É *</label>
                    <input type="number" id="chapter_number" name="chapter_number" step="0.1" required placeholder="1">
                </div>

                <div class="form-group">
                    <label for="chapter_title">–ù–∞–∑–≤–∞ —Ä–æ–∑–¥—ñ–ª—É</label>
                    <input type="text" id="chapter_title" name="title" placeholder="–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ">
                </div>

                <button type="submit" class="btn-primary">–î–æ–¥–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª</button>
            </form>
        </div>

        <!-- Add Pages Form -->
        <div class="admin-card full-width">
            <h2 class="card-title">üñºÔ∏è –î–æ–¥–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏</h2>
            <form method="POST" action="{{ url_for('add_pages') }}" class="admin-form">
                <div class="form-row">
                    <div class="form-group flex-1">
                        <label for="page_manga_id">–ú–∞–Ω–≥–∞ *</label>
                        <select id="page_manga_id" name="page_manga_id" required onchange="loadChapters(this.value)">
                            <option value="">–û–±–µ—Ä—ñ—Ç—å –º–∞–Ω–≥—É</option>
                            {% for manga in manga_list %}
                            <option value="{{ manga.id }}">{{ manga.title }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group flex-1">
                        <label for="chapter_id">–†–æ–∑–¥—ñ–ª *</label>
                        <select id="chapter_id" name="chapter_id" required>
                            <option value="">–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å –º–∞–Ω–≥—É</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="page_urls">URL —Å—Ç–æ—Ä—ñ–Ω–æ–∫ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ä—è–¥–æ–∫) *</label>
                    <textarea id="page_urls" name="page_urls" rows="10" required
                        placeholder="https://example.com/page1.jpg&#10;https://example.com/page2.jpg&#10;https://example.com/page3.jpg"></textarea>
                    <small class="form-hint">–í—Å—Ç–∞–≤—Ç–µ URL –∑–æ–±—Ä–∞–∂–µ–Ω—å, –∫–æ–∂–µ–Ω –Ω–∞ –Ω–æ–≤–æ–º—É —Ä—è–¥–∫—É. –í–æ–Ω–∏ –±—É–¥—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
                        –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω—ñ.</small>
                </div>

                <button type="submit" class="btn-primary">–î–æ–¥–∞—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadChapters(mangaId) {
        const chapterSelect = document.getElementById('chapter_id');

        if (!mangaId) {
            chapterSelect.innerHTML = '<option value="">–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å –º–∞–Ω–≥—É</option>';
            return;
        }

        try {
            const response = await fetch(`/admin/get_chapters/${mangaId}`);
            const chapters = await response.json();

            if (chapters.length === 0) {
                chapterSelect.innerHTML = '<option value="">–ù–µ–º–∞—î —Ä–æ–∑–¥—ñ–ª—ñ–≤ –¥–ª—è —Ü—ñ—î—ó –º–∞–Ω–≥–∏</option>';
            } else {
                chapterSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–¥—ñ–ª</option>';
                chapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter.id;
                    option.textContent = `–†–æ–∑–¥—ñ–ª ${chapter.chapter_number}${chapter.title ? ' - ' + chapter.title : ''}`;
                    chapterSelect.appendChild(option);
                });
            }
        } catch (error) {
            console.error('Error loading chapters:', error);
            chapterSelect.innerHTML = '<option value="">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–¥—ñ–ª—ñ–≤</option>';
        }
    }
</script>
{% endblock %}